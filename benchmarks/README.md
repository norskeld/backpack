# Benchmarks

Install dependencies first:

```
npm i
```

Then run benchmarks:

```sh
npm run bench:perf
npm run bench:size
```

## Size

On average BackPack lets one to shave off 20-30% from payload size.

> [!NOTE]\
> There's a catch with gzipping MessagePack/BackPack payloads though: in order to get good results the strategy should be set either to `Z_RLE` or `Z_HUFFMAN_ONLY` (the former works slightly better). Other strategies, including the default one, result in quite inefficient compression for these two formats, but it does wonders for JSON.

```
┌─────────────────────────────────────────────────────────────────┐
│                       Average (all cases)                       │
├───────────────┬────────────────────────┬────────────────────────┤
│ Format        │ Normal                 │ Gzipped                │
├───────────────┼────────────────────────┼────────────────────────┤
│ JSON          │ 8.42 MB                │ 5.33 MB                │
│               ├────────────────────────┼────────────────────────┤
│               │ +13.8% to MessagePack  │ +8.17% to MessagePack  │
│               ├────────────────────────┼────────────────────────┤
│               │ +34.6% to BackPack     │ +30.89% to BackPack    │
├───────────────┼────────────────────────┼────────────────────────┤
│ MessagePack   │ 7.26 MB                │ 4.89 MB                │
│               ├────────────────────────┼────────────────────────┤
│               │ -13.8% to JSON         │ -8.17% to JSON         │
│               ├────────────────────────┼────────────────────────┤
│               │ +24.14% to BackPack    │ +24.74% to BackPack    │
├───────────────┼────────────────────────┼────────────────────────┤
│ BackPack      │ 5.51 MB                │ 3.68 MB                │
│               ├────────────────────────┼────────────────────────┤
│               │ -34.6% to JSON         │ -30.89% to JSON        │
│               ├────────────────────────┼────────────────────────┤
│               │ -24.14% to MessagePack │ -24.74% to MessagePack │
└───────────────┴────────────────────────┴────────────────────────┘

┌────────────────────────────────────────────────────────────────┐
│                       Median (all cases)                       │
├───────────────┬────────────────────────┬───────────────────────┤
│ Format        │ Normal                 │ Gzipped               │
├───────────────┼────────────────────────┼───────────────────────┤
│ JSON          │ 317.71 kB              │ 207.08 kB             │
│               ├────────────────────────┼───────────────────────┤
│               │ +12.97% to MessagePack │ +7.26% to MessagePack │
│               ├────────────────────────┼───────────────────────┤
│               │ +27.97% to BackPack    │ +23.49% to BackPack   │
├───────────────┼────────────────────────┼───────────────────────┤
│ MessagePack   │ 276.51 kB              │ 192.04 kB             │
│               ├────────────────────────┼───────────────────────┤
│               │ -12.97% to JSON        │ -7.26% to JSON        │
│               ├────────────────────────┼───────────────────────┤
│               │ +17.23% to BackPack    │ +17.5% to BackPack    │
├───────────────┼────────────────────────┼───────────────────────┤
│ BackPack      │ 228.86 kB              │ 158.44 kB             │
│               ├────────────────────────┼───────────────────────┤
│               │ -27.97% to JSON        │ -23.49% to JSON       │
│               ├────────────────────────┼───────────────────────┤
│               │ -17.23% to MessagePack │ -17.5% to MessagePack │
└───────────────┴────────────────────────┴───────────────────────┘
```

<details>
<summary>Click to see more results with payloads of different size.</summary>

```
┌────────────────────────────────────────────────────────────────┐
│                         Case 'one (1)'                         │
├───────────────┬────────────────────────┬───────────────────────┤
│ Format        │ Normal                 │ Gzipped               │
├───────────────┼────────────────────────┼───────────────────────┤
│ JSON          │ 2.31 kB                │ 1.53 kB               │
│               ├────────────────────────┼───────────────────────┤
│               │ +13.94% to MessagePack │ +6.51% to MessagePack │
│               ├────────────────────────┼───────────────────────┤
│               │ +11.11% to BackPack    │ -1.57% to BackPack    │
├───────────────┼────────────────────────┼───────────────────────┤
│ MessagePack   │ 1.99 kB                │ 1.43 kB               │
│               ├────────────────────────┼───────────────────────┤
│               │ -13.94% to JSON        │ -6.51% to JSON        │
│               ├────────────────────────┼───────────────────────┤
│               │ -3.18% to BackPack     │ -7.97% to BackPack    │
├───────────────┼────────────────────────┼───────────────────────┤
│ BackPack      │ 2.06 kB                │ 1.56 kB               │
│               ├────────────────────────┼───────────────────────┤
│               │ -11.11% to JSON        │ +1.57% to JSON        │
│               ├────────────────────────┼───────────────────────┤
│               │ +3.18% to MessagePack  │ +7.97% to MessagePack │
└───────────────┴────────────────────────┴───────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                         Case 'sm (100)'                         │
├───────────────┬────────────────────────┬────────────────────────┤
│ Format        │ Normal                 │ Gzipped                │
├───────────────┼────────────────────────┼────────────────────────┤
│ JSON          │ 472.66 kB              │ 298.84 kB              │
│               ├────────────────────────┼────────────────────────┤
│               │ +13.82% to MessagePack │ +8.2% to MessagePack   │
│               ├────────────────────────┼────────────────────────┤
│               │ +28.79% to BackPack    │ +24.3% to BackPack     │
├───────────────┼────────────────────────┼────────────────────────┤
│ MessagePack   │ 407.32 kB              │ 274.35 kB              │
│               ├────────────────────────┼────────────────────────┤
│               │ -13.82% to JSON        │ -8.2% to JSON          │
│               ├────────────────────────┼────────────────────────┤
│               │ +17.37% to BackPack    │ +17.54% to BackPack    │
├───────────────┼────────────────────────┼────────────────────────┤
│ BackPack      │ 336.57 kB              │ 226.22 kB              │
│               ├────────────────────────┼────────────────────────┤
│               │ -28.79% to JSON        │ -24.3% to JSON         │
│               ├────────────────────────┼────────────────────────┤
│               │ -17.37% to MessagePack │ -17.54% to MessagePack │
└───────────────┴────────────────────────┴────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                        Case 'md (1,000)'                        │
├───────────────┬────────────────────────┬────────────────────────┤
│ Format        │ Normal                 │ Gzipped                │
├───────────────┼────────────────────────┼────────────────────────┤
│ JSON          │ 4.51 MB                │ 2.85 MB                │
│               ├────────────────────────┼────────────────────────┤
│               │ +13.82% to MessagePack │ +8.19% to MessagePack  │
│               ├────────────────────────┼────────────────────────┤
│               │ +34.04% to BackPack    │ +30.26% to BackPack    │
├───────────────┼────────────────────────┼────────────────────────┤
│ MessagePack   │ 3.89 MB                │ 2.62 MB                │
│               ├────────────────────────┼────────────────────────┤
│               │ -13.82% to JSON        │ -8.19% to JSON         │
│               ├────────────────────────┼────────────────────────┤
│               │ +23.46% to BackPack    │ +24.04% to BackPack    │
├───────────────┼────────────────────────┼────────────────────────┤
│ BackPack      │ 2.98 MB                │ 1.99 MB                │
│               ├────────────────────────┼────────────────────────┤
│               │ -34.04% to JSON        │ -30.26% to JSON        │
│               ├────────────────────────┼────────────────────────┤
│               │ -23.46% to MessagePack │ -24.04% to MessagePack │
└───────────────┴────────────────────────┴────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                       Case 'lg (10,000)'                        │
├───────────────┬────────────────────────┬────────────────────────┤
│ Format        │ Normal                 │ Gzipped                │
├───────────────┼────────────────────────┼────────────────────────┤
│ JSON          │ 45.23 MB               │ 28.60 MB               │
│               ├────────────────────────┼────────────────────────┤
│               │ +13.83% to MessagePack │ +8.2% to MessagePack   │
│               ├────────────────────────┼────────────────────────┤
│               │ +34.78% to BackPack    │ +31.11% to BackPack    │
├───────────────┼────────────────────────┼────────────────────────┤
│ MessagePack   │ 38.98 MB               │ 26.26 MB               │
│               ├────────────────────────┼────────────────────────┤
│               │ -13.83% to JSON        │ -8.2% to JSON          │
│               ├────────────────────────┼────────────────────────┤
│               │ +24.32% to BackPack    │ +24.96% to BackPack    │
├───────────────┼────────────────────────┼────────────────────────┤
│ BackPack      │ 29.50 MB               │ 19.70 MB               │
│               ├────────────────────────┼────────────────────────┤
│               │ -34.78% to JSON        │ -31.11% to JSON        │
│               ├────────────────────────┼────────────────────────┤
│               │ -24.32% to MessagePack │ -24.96% to MessagePack │
└───────────────┴────────────────────────┴────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                       Case 'lg (100,000)'                       │
├───────────────┬────────────────────────┬────────────────────────┤
│ Format        │ Normal                 │ Gzipped                │
├───────────────┼────────────────────────┼────────────────────────┤
│ JSON          │ 453.73 MB              │ 286.88 MB              │
│               ├────────────────────────┼────────────────────────┤
│               │ +13.82% to MessagePack │ +8.2% to MessagePack   │
│               ├────────────────────────┼────────────────────────┤
│               │ +35.16% to BackPack    │ +31.54% to BackPack    │
├───────────────┼────────────────────────┼────────────────────────┤
│ MessagePack   │ 391.01 MB              │ 263.37 MB              │
│               ├────────────────────────┼────────────────────────┤
│               │ -13.82% to JSON        │ -8.2% to JSON          │
│               ├────────────────────────┼────────────────────────┤
│               │ +24.76% to BackPack    │ +25.43% to BackPack    │
├───────────────┼────────────────────────┼────────────────────────┤
│ BackPack      │ 294.18 MB              │ 196.40 MB              │
│               ├────────────────────────┼────────────────────────┤
│               │ -35.16% to JSON        │ -31.54% to JSON        │
│               ├────────────────────────┼────────────────────────┤
│               │ -24.76% to MessagePack │ -25.43% to MessagePack │
└───────────────┴────────────────────────┴────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│               Case 'rust-lang repositories list'                │
├───────────────┬────────────────────────┬────────────────────────┤
│ Format        │ Normal                 │ Gzipped                │
├───────────────┼────────────────────────┼────────────────────────┤
│ JSON          │ 154.68 kB              │ 94.31 kB               │
│               ├────────────────────────┼────────────────────────┤
│               │ +8.05% to MessagePack  │ +3.62% to MessagePack  │
│               ├────────────────────────┼────────────────────────┤
│               │ +21.67% to BackPack    │ +15.47% to BackPack    │
├───────────────┼────────────────────────┼────────────────────────┤
│ MessagePack   │ 142.23 kB              │ 90.89 kB               │
│               ├────────────────────────┼────────────────────────┤
│               │ -8.05% to JSON         │ -3.62% to JSON         │
│               ├────────────────────────┼────────────────────────┤
│               │ +14.81% to BackPack    │ +12.29% to BackPack    │
├───────────────┼────────────────────────┼────────────────────────┤
│ BackPack      │ 121.16 kB              │ 79.72 kB               │
│               ├────────────────────────┼────────────────────────┤
│               │ -21.67% to JSON        │ -15.47% to JSON        │
│               ├────────────────────────┼────────────────────────┤
│               │ -14.81% to MessagePack │ -12.29% to MessagePack │
└───────────────┴────────────────────────┴────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                 Case 'npm meta for @nrsk/sigma'                 │
├───────────────┬────────────────────────┬────────────────────────┤
│ Format        │ Normal                 │ Gzipped                │
├───────────────┼────────────────────────┼────────────────────────┤
│ JSON          │ 162.77 kB              │ 115.32 kB              │
│               ├────────────────────────┼────────────────────────┤
│               │ +10.49% to MessagePack │ +4.85% to MessagePack  │
│               ├────────────────────────┼────────────────────────┤
│               │ +28.85% to BackPack    │ +21.39% to BackPack    │
├───────────────┼────────────────────────┼────────────────────────┤
│ MessagePack   │ 145.70 kB              │ 109.73 kB              │
│               ├────────────────────────┼────────────────────────┤
│               │ -10.49% to JSON        │ -4.85% to JSON         │
│               ├────────────────────────┼────────────────────────┤
│               │ +20.52% to BackPack    │ +17.38% to BackPack    │
├───────────────┼────────────────────────┼────────────────────────┤
│ BackPack      │ 115.81 kB              │ 90.66 kB               │
│               ├────────────────────────┼────────────────────────┤
│               │ -28.85% to JSON        │ -21.39% to JSON        │
│               ├────────────────────────┼────────────────────────┤
│               │ -20.52% to MessagePack │ -17.38% to MessagePack │
└───────────────┴────────────────────────┴────────────────────────┘
```

</details>

## Performance

It's not fast, but not slow either, and performs mostly on par with the official implementation.

### Serialize

```
Running "Serialize" suite...
Progress: 100%

  BackPack:                       765 ops/s, ±0.62%     | 48.45% slower
  MessagePack (@msgpack/msgpack): 647 ops/s, ±0.89%     | slowest, 56.4% slower
  MessagePack (msgpackr):         994 ops/s, ±1.30%     | 33.02% slower
  JSON.stringify:                 1 484 ops/s, ±0.78%   | fastest
```

### Deserialize

```
Running "Deserialize" suite...
Progress: 100%

  BackPack:                       479 ops/s, ±0.63%     | slowest, 59.02% slower
  MessagePack (@msgpack/msgpack): 486 ops/s, ±0.59%     | 58.43% slower
  MessagePack (msgpackr):         1 014 ops/s, ±0.92%   | 13.26% slower
  JSON.parse:                     1 169 ops/s, ±0.78%   | fastest
```
